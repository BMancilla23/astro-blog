---

/**
 * Importamos la configuración general del sitio
 * el layour principal y el componente PostCard
 * */

import { siteConfig } from "@/config/site-config";
import MainLayout from "../layouts/MainLayout.astro";
import PostCard from "@/components/PostCard.astro";

// Importamos un tipo para describir los módulos de post


import type { MarkdownInstance } from "astro";
import type { PostMeta } from "@/types/post";


// const posts = await Astro.glob('./posts/*.{md, mdx}')



/**
 * Definimos el tipo de cada Post que vamos a cargar:
 * - frontmatter: metadata definida en cada archivo .md o mdx
 * - content: el contenido renderizado del post
 * - file: la ruta al archivo
*/
/* type PostModule = {
	// frontmatter: {
	// 	title: string;
	// 	date: string;
	// 	description: string;
	// 	author: string;
	// 	image?: string;
	// 	tags?: string[]
	// };
	frontmatter: PostFrontmatter;
	content: AstroComponentFactory;
	file: string;
	url: string;
} */

type PostFrontmatter = PostMeta;

type PostModule = MarkdownInstance<PostFrontmatter>;

/**
 * import.meta.glob es como un "scanner" de archivos.
 * La decimos: busca todos los archivos dentro de ./posts que sean .md o .mdx
 * Y asume que cumplen con el tipo PostModule que definimos arriba
*/
const postModules = import.meta.glob<PostModule>('./posts-old/*.{md, mdx}')

/**
 * Cada postModule es una función "loader" que carga el conienido del post.
 * Promise.all espera a que todos se carguen y devuelva un array con todos los posts
*/
const posts = await Promise.all(Object.values(postModules).map(loader => loader()))

console.log('Posts', posts) // Debug: mira en consola qué datos llegan

/* const posts = [
	 {
    // image: "https://source.unsplash.com/600x400/?marketing,business",
    alt: "Boost conversion image",
    date: "Mar 16, 2020",
    category: "Marketing",
    title: "Boost your conversion rate",
    description: "Illo sint voluptas. Error voluptates culpa eligendi...",
    author: {
      name: "Michael Foster",
      role: "Co-Founder / CTO",
      avatar: "https://images.unsplash.com/photo-1519244703995-f4e0f30006d5?&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
    }
  },
  {
    // image: "https://source.unsplash.com/600x400/?seo,sales",
    alt: "SEO sales image",
    date: "Mar 10, 2020",
    category: "Sales",
    title: "How to use search engine optimization to drive sales",
    description: "Optio cum necessitatibus dolor voluptatum provident commodi...",
    author: {
      name: "Lindsay Walton",
      role: "Front-end Developer",
      avatar: "https://images.unsplash.com/photo-1517841905240-472988babdf9?&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
    }
  },
  {
    // image: "https://source.unsplash.com/600x400/?customer,experience",
    alt: "Customer experience image",
    date: "Feb 12, 2020",
    category: "Business",
    title: "Improve your customer experience",
    description: "Cupiditate maiores ullam eveniet adipisci in doloribus nulla minus...",
    author: {
      name: "Tom Cook",
      role: "Director of Product",
      avatar: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
    }
  }
] */
---

<MainLayout title="Bryan's Blog" >
	<!-- <div class="bg-gray-900 py-24 sm:py-32"> -->
  <div class="mx-auto max-w-7xl px-6 lg:px-8">

	<!-- Header del blog -->
    <div class="mx-auto max-w-2xl lg:mx-0">
      <h2 class="text-4xl font-semibold tracking-tight text-pretty text-white sm:text-5xl">{siteConfig.title}</h2>
      <p class="mt-2 text-lg/8 text-gray-300">Learn how to grow your business with our expert advice.</p>
    </div>

	<!-- Grid de posts -->
    <div class="mx-auto mt-10 grid max-w-2xl grid-cols-1 gap-x-8 gap-y-16 border-t border-gray-700 pt-10 sm:mt-16 sm:pt-16 lg:mx-0 lg:max-w-none lg:grid-cols-3">
      
    {

/**
 * Recorremos cada post y lo pasamos al componente <PostCard>.
 * Usamos "spread props" {...post.frontmatter} para pasar
 * automáticamente todas las propiedades (title, date, etc.)
*/

		posts.map(post => (
			<PostCard {...post.frontmatter} href={post.url}/>
		))
	}
     
    </div>
  </div>
<!-- </div> -->

</MainLayout>